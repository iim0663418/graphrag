# 後端 GraphRAG 整合修正計劃

## 🎯 問題總結
- **前端**: ✅ 深度提取 UI 完整，索引進度追蹤正常
- **後端**: ❌ 無法執行 GraphRAG 索引 (ModuleNotFoundError)
- **根因**: Python 執行環境無法找到 GraphRAG 模組

## 📋 修正計劃

### 階段 1: 修復 Python 模組路徑 (立即執行)
**目標**: 讓後端能正確調用 GraphRAG
**時間**: 15 分鐘

1. **修改後端執行命令**
   - 從相對路徑改為絕對路徑執行
   - 使用 PYTHONPATH 環境變量
   - 或直接在項目根目錄執行

2. **修改 main.py 中的索引函數**
   ```python
   # 修改 run_real_indexing() 和 trigger_indexing()
   # 使用項目根目錄作為執行路徑
   project_root = Path(__file__).parent.parent.parent
   cmd = [sys.executable, "-m", "graphrag.index", "--root", str(backend_dir)]
   # 在 project_root 目錄執行
   ```

### 階段 2: 測試和驗證 (立即執行)
**目標**: 確認修復效果
**時間**: 10 分鐘

1. **測試索引 API**
   - 調用 `/api/indexing/start`
   - 監控進度和日誌
   - 確認 parquet 文件生成

2. **測試搜尋功能**
   - 測試全域搜尋
   - 測試本地搜尋
   - 驗證圖譜數據

### 階段 3: 前端整合測試 (後續執行)
**目標**: 端到端功能驗證
**時間**: 5 分鐘

1. **前端深度提取流程測試**
   - 上傳文件
   - 觸發索引
   - 監控進度
   - 驗證搜尋結果

## 🚀 立即行動項目

### 優先級 P0 (立即修復)
1. 修改 `main.py` 中的 GraphRAG 執行路徑
2. 測試索引 API 是否正常工作
3. 驗證 parquet 文件生成

### 優先級 P1 (後續優化)
1. 改善錯誤處理和日誌記錄
2. 優化進度追蹤準確性
3. 添加更詳細的狀態回報

## 📝 預期結果
修復完成後應該實現:
- ✅ 前端可以觸發真實的 GraphRAG 索引
- ✅ 索引進度正確追蹤和顯示
- ✅ 生成完整的 parquet 文件 (14個)
- ✅ 搜尋功能正常工作
- ✅ 圖譜可視化正常顯示

## ⚠️ 風險評估
- **低風險**: 只修改執行路徑，不改變核心邏輯
- **回退方案**: 保留原始代碼備份
- **測試策略**: 逐步驗證每個修改點
